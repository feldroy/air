// .github/renovate.json5
// https://docs.renovatebot.com
{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",
  dependencyDashboard: true,
  extends: [
    "config:best-practices",
    "helpers:pinGitHubActionDigests",
    "helpers:pinGitHubActionDigestsToSemver",
    "schedule:automergeDaily",
    ":dependencyDashboard",
    ":enablePreCommit",
    ":rebaseStalePrs",
    ":semanticCommitType(build)",
    ":semanticCommitScope(deps)",
    ":maintainLockFilesWeekly",
    ":prHourlyLimitNone"
  ],
  // Keep semantic commits explicit even though the preset already sets the scope
  semanticCommitScope: "deps",
  prCreation: "immediate",
  prConcurrentLimit: 3,
  prHourlyLimit: 3,
  suppressNotifications: [
    'prEditedNotification'
  ],
  // Rebase PRs when they fall behind the base branch
  "rebaseWhen": "behind-base-branch",
  labels: [
    "deps",
    "renovate"
  ],
  // Limit Renovate to these managers only
  enabledManagers: [
    "pep621",
    "pep723",
    "pre-commit",
    "github-actions",
    "renovate-config-presets"
  ],
  // Weekly lockfile refreshes (e.g., uv.lock)
  lockFileMaintenance: {
    enabled: true
  },
  "pre-commit": {
    enabled: true,
    managerFilePatterns: [
      // Matches: .pre-commit-config-check.yaml, .pre-commit-config-format.yaml, etc
      "/(^|/)\\.pre-commit-config-[^/.]+\\.ya?ml$/"
    ],
  },
  updatePinnedDependencies: true,
  packageRules: [
    // Pin GitHub Actions to immutable SHAs.
    {
      matchDepTypes: [
        "action"
      ],
      pinDigests: true,
    },
    // Annotate GitHub Actions SHAs with a SemVer version.
    {
      extends: [
        "helpers:pinGitHubActionDigests"
      ],
      extractVersion: "^(?<version>v?\\d+\\.\\d+\\.\\d+)$",
      versioning: "regex:^v?(?<major>\\d+)(\\.(?<minor>\\d+)\\.(?<patch>\\d+))?$",
    },
    {
      // Disable GitHub runner updates; only pin a runner version when there is a clear reason.
      groupName: "GitHub runners",
      matchManagers: [
        "github-actions"
      ],
      matchDatasources: [
        "github-runners"
      ],
      description: "Disable PRs updating GitHub runners (e.g. 'runs-on: macos-14')",
      enabled: false,
    },
    {
      groupName: "pre-commit dependencies",
      matchManagers: [
        "pre-commit"
      ],
      description: "Weekly update of pre-commit dependencies",
    }
  ],
}
