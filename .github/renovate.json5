// .github/renovate.json5
// https://docs.renovatebot.com
{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",
  // Enable Renovate.
  "enabled": true,
  // https://docs.renovatebot.com/key-concepts/automerge/#if-you-use-github-actions
  platformAutomerge: true,
  dependencyDashboard: true,
  configMigration: true,
  updatePinnedDependencies: true,
  separateMajorMinor: false,
  extends: [
    "config:best-practices",
    "helpers:pinGitHubActionDigestsToSemver",
    ":maintainLockFilesWeekly",
    // Disable automerging feature - wait for humans to merge all PRs.
    ":automergeDisabled",
    ":automergePr",
    ":automergeRequireAllStatusChecks",
    // conventional commits
    ":semanticCommitType(build)",
    ":semanticCommitScope(deps)"
  ],
  // Keep semantic commit scope explicit
  semanticCommits: "enabled",
  semanticCommitType: "build",
  semanticCommitScope: "deps",
  prCreation: "immediate",
  prConcurrentLimit: 5,
  prHourlyLimit: 5,
  // Default blanket cooldown of 2 days to all dependencies.
  minimumReleaseAge: '2 days',
  internalChecksFilter: 'strict',
  suppressNotifications: [
    "prEditedNotification",
    "prIgnoreNotification"
  ],
  // Rebase PRs when they fall behind the base branch
  "rebaseWhen": "behind-base-branch",
  // Add the renovate/ prefix to all branch names
  "branchPrefix": "renovate/",
  labels: [
    "deps",
    "renovate"
  ],
  // Limit Renovate to these managers only
  enabledManagers: [
    // Python: pyproject.toml (PEP 621) with uv.lock
    "pep621",
    // Inline script dependencies
    "pep723",
    // Other repo automation
    "pre-commit",
    "github-actions",
    // Keep renovate config presets updated
    "renovate-config-presets"
  ],
  "pre-commit": {
    enabled: true,
    managerFilePatterns: [
      // Matches: .pre-commit-config-check.yaml, .pre-commit-config-format.yaml, etc
      "/(^|/)\\.pre-commit-config-[^/.]+\\.ya?ml$/"
    ],
  },
  pep621: {
    enabled: true,
    // Default for pep621, kept explicit here
    managerFilePatterns: [
      "/(^|/)pyproject\\.toml$/"
    ],
  },
  "lockFileMaintenance": {
    "enabled": true,
    "recreateWhen": "always",
    "branchTopic": "lock-file-maintenance",
    "commitMessageAction": "Lock file maintenance",
    "prBodyDefinitions": {
      "Change": "All locks refreshed"
    }
  },
  packageRules: [
    // Order your packageRules so the least important rules are at the top,
    // and the most important rules are at the bottom.
    // This way, important rules override earlier rule settings when needed.
    {
      matchUpdateTypes: [
        "lockFileMaintenance"
      ],
      matchFileNames: [
        "uv.lock",
        "**/uv.lock"
      ],
      groupName: "lockfile updates",
      description: "Lock file maintenance only for uv.lock"
    },
    {
      matchManagers: [
        "pep723"
      ],
      groupName: "Inline script metadata (PEP 723)",
      description: "Group updates for dependencies declared in PEP 723 script blocks.",
    },
    {
      matchManagers: [
        "github-actions"
      ],
      groupName: "GitHub Actions",
      description: "Group updates for GitHub Actions used in workflows.",
    },
    {
      matchManagers: [
        "renovate-config-presets"
      ],
      groupName: "Renovate presets",
      description: "Group updates for Renovate config presets and shared configs.",
    },
    {
      matchManagers: [
        "pre-commit"
      ],
      groupName: "pre-commit hooks",
      description: "Group updates for pre-commit hook repos and versions.",
    },
    {
      matchManagers: [
        "pep621"
      ],
      matchDepTypes: [
        "dependency-groups"
      ],
      rangeStrategy: "pin",
      groupName: "Python dependencies (pyproject.toml) - [dependency-groups]",
      description: "Pin dependency-groups to exact versions (==) and keep them updated"
    },
    {
      matchManagers: [
        "pep621"
      ],
      matchDepTypes: [
        "project.dependencies",
        "project.optional-dependencies"
      ],
      rangeStrategy: "update-lockfile",
      groupName: "Python dependencies (pyproject.toml) - [project.dependencies, project.optional-dependencies]",
      description: "Keep library constraints (>=) stable, update only uv.lock",
      minimumReleaseAge: null
    }
  ]
}
